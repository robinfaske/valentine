<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Will you be my Valentine?</title>

  <style>
    :root{
      --bg1:#ffe6ef;
      --bg2:#fff6fb;
      --card:#ffffffcc;
      --pink:#ff4fa3;
      --pink2:#ff86c6;
      --shadow: 0 18px 45px rgba(255, 79, 163, .18);
    }

    *{ box-sizing:border-box; }

    /*
      Custom cursor:
      - Put cursor.png next to index.html (ideally ~32x32 transparent).
      - Optional: also add cursor.cur for best compatibility; we try .cur first. [web:76]
    */
    html, body{
      cursor: url("cursor.cur"), url("cursor.png") 16 16, auto;
    }
    button, a{
      cursor: url("cursor.cur"), url("cursor.png") 16 16, pointer;
    }

    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
      user-select:none;
      background:
        radial-gradient(900px 500px at 20% 20%, #fff 0%, transparent 55%),
        radial-gradient(700px 450px at 80% 30%, #fff 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    /* Floating background hearts */
    .bg-heart{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 0;
      opacity: .35;
      filter: blur(.2px);
    }
    .bg-heart::before,
    .bg-heart::after{
      content:"";
      position:absolute;
      width: 14px;
      height: 14px;
      background: rgba(255, 79, 163, .22);
      transform: rotate(45deg);
      border-radius: 3px;
      animation: floaty 7s linear infinite;
    }
    .bg-heart::before{ left: 10%; top: 75%; animation-duration: 8.5s; }
    .bg-heart::after{ left: 82%; top: 80%; animation-duration: 10.5s; background: rgba(255, 134, 198, .20); }

    @keyframes floaty{
      0%{ transform: translateY(0) rotate(45deg); opacity:.15; }
      60%{ opacity:.30; }
      100%{ transform: translateY(-120vh) rotate(45deg); opacity:.0; }
    }

    /* Flowers pinned to viewport */
    .flower{
      position: fixed;
      pointer-events: none;
      z-index: 2;
      opacity: .98;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,.10));
      height: auto;
    }
    .flower.topleft{ top:-10px; left:-10px; width:min(260px, 36vw); }
    .flower.topright{ top:-10px; right:-10px; width:min(260px, 36vw); }
    .flower.bottom{
      bottom:-12px;
      left:50%;
      transform: translateX(-50%);
      width:min(520px, 86vw);
      z-index: 1;
      opacity: .92;
    }

    /* Card */
    .card{
      position: relative;
      z-index: 10;
      width: min(560px, calc(100vw - 32px));
      padding: 28px 22px;
      border-radius: 22px;
      background: var(--card);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 79, 163, .18);
      backdrop-filter: blur(6px);
      text-align:center;
      margin: 0 auto;
      top: 50vh;
      transform: translateY(-55%);
    }

    h1{
      margin: 0 0 10px;
      font-size: clamp(24px, 4vw, 34px);
      letter-spacing:.2px;
    }
    p{ margin: 0 0 18px; opacity:.75; }

    .buttons{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:14px;
      margin-top: 14px;
    }

    button{
      border:0;
      padding: 12px 18px;
      font-size: 18px;
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
      transition: transform .08s ease, filter .2s ease, left 140ms ease, top 140ms ease;
      min-width: 120px;
      background: #fff;
      color: #444;
    }
    button:active{ transform: translateY(1px) scale(.99); }
    button:focus-visible{ outline: 3px solid rgba(255,79,163,.35); outline-offset: 3px; }

    #yes{
      background: linear-gradient(135deg, #ff3f9a, #ff77c4);
      color:#fff;
    }

    #no{
      border: 1px solid rgba(0,0,0,.08);
      position: static; /* starts next to Yes */
      z-index: 12;
    }

    /* Placeholder keeps row centered when No detaches */
    #no-placeholder{
      display:none;
      width: 120px;
      height: 44px;
    }

    /* Cursor heart trail */
    .heart{
      position: fixed;
      left: 0;
      top: 0;
      transform: translate(-50%, -50%);
      pointer-events:none;
      z-index: 9999;
      color: var(--pink);
      text-shadow: 0 6px 18px rgba(255, 79, 163, .28);
      will-change: transform, opacity;
      animation: heart-float 900ms ease-out forwards;
    }
    @keyframes heart-float{
      0%   { opacity: 1; transform: translate(-50%, -50%) translateY(0) scale(1) rotate(0deg); }
      100% { opacity: 0; transform: translate(-50%, -50%) translateY(-42px) scale(.7) rotate(12deg); }
    }

    @media (max-width: 420px){
      button{ min-width: 110px; font-size: 17px; }
      .card{ padding: 22px 16px; }
      .flower.bottom{ width: min(520px, 96vw); }
    }
  </style>
</head>

<body>
  <div class="bg-heart" aria-hidden="true"></div>

  <!-- Your repo images -->
  <img class="flower topleft"  src="topleft.png"  alt="" aria-hidden="true">
  <img class="flower topright" src="topright.png" alt="" aria-hidden="true">
  <img class="flower bottom"   src="bottom.png"  alt="" aria-hidden="true">

  <main class="card" id="card">
    <h1>Will you be my Valentine? üíò</h1>
    <p>(Be honest‚Ä¶ if you can catch the ‚ÄúNo‚Äù.)</p>

    <div class="buttons" id="buttonRow">
      <button id="yes">Yes</button>
      <span id="no-placeholder" aria-hidden="true"></span>
      <button id="no" aria-label="No">No</button>
    </div>
  </main>

  <script>
    const yesBtn = document.getElementById('yes');
    const noBtn  = document.getElementById('no');
    const card   = document.getElementById('card');
    const row    = document.getElementById('buttonRow');
    const ph     = document.getElementById('no-placeholder');

    // ---------- iCal all-day download ----------
    function pad2(n){ return String(n).padStart(2, '0'); }

    // YYYYMMDD for VALUE=DATE
    function toICSDateLocal(d){
      return `${d.getFullYear()}${pad2(d.getMonth()+1)}${pad2(d.getDate())}`;
    }

    // YYYYMMDDTHHMMSSZ for DTSTAMP (UTC)
    function toICSDateTimeUTC(d){
      return `${d.getUTCFullYear()}${pad2(d.getUTCMonth()+1)}${pad2(d.getUTCDate())}T${pad2(d.getUTCHours())}${pad2(d.getUTCMinutes())}${pad2(d.getUTCSeconds())}Z`;
    }

    function downloadAllDayICS({ title, description, location, dayLocal }){
      // All-day is represented as DATE values; DTEND is non-inclusive, so we use next day. [web:95]
      const start = new Date(dayLocal);
      start.setHours(0,0,0,0);

      const endExclusive = new Date(start);
      endExclusive.setDate(start.getDate() + 1);

      const uid = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())) + "@valentine";

      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Valentine Page//EN
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${toICSDateTimeUTC(new Date())}
DTSTART;VALUE=DATE:${toICSDateLocal(start)}
DTEND;VALUE=DATE:${toICSDateLocal(endExclusive)}
SUMMARY:${title}
DESCRIPTION:${description}
LOCATION:${location}
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = "valentine-invite.ics";
      document.body.appendChild(a);
      a.click();
      a.remove();

      URL.revokeObjectURL(url);
    }

    yesBtn.addEventListener('click', () => {
      // Default: all-day event for tomorrow (change here if you want a specific date)
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);

      downloadAllDayICS({
        title: "Valentine Day üíò",
        description: "You clicked Yes üôÇ",
        location: "TBD",
        dayLocal: tomorrow
      });

      alert("Yay!! ‚ù§Ô∏èüå∏ Your all-day iCal invite was downloaded.");
    });

    // ---------- No button (detaches + flees) ----------
    let lastMove = 0;
    let dodges = 0;
    let detached = false;

    const FLEE_RADIUS = 130;
    const COOLDOWN_MS = 120;
    const EDGE_PAD = 12;
    const MAX_TRIES = 40;

    function rectsOverlap(a, b){
      return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
    }

    function detachNoButton(){
      if (detached) return;
      detached = true;

      const r = noBtn.getBoundingClientRect();

      ph.style.display = 'inline-block';
      ph.style.width  = `${r.width}px`;
      ph.style.height = `${r.height}px`;

      document.body.appendChild(noBtn);
      noBtn.style.position = 'fixed';
      noBtn.style.left = `${r.left}px`;
      noBtn.style.top  = `${r.top}px`;
    }

    function placeNoButtonRandom(avoidPoint){
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const forbidden = card.getBoundingClientRect();
      const btnW = noBtn.offsetWidth;
      const btnH = noBtn.offsetHeight;

      const minX = EDGE_PAD;
      const maxX = vw - btnW - EDGE_PAD;
      const minY = EDGE_PAD;
      const maxY = vh - btnH - EDGE_PAD;

      for(let i=0;i<MAX_TRIES;i++){
        const x = minX + Math.random() * (maxX - minX);
        const y = minY + Math.random() * (maxY - minY);

        const candidate = { left:x, top:y, right:x+btnW, bottom:y+btnH };
        if(rectsOverlap(candidate, forbidden)) continue;

        if(avoidPoint){
          const cx = x + btnW/2;
          const cy = y + btnH/2;
          const d = Math.hypot(cx - avoidPoint.x, cy - avoidPoint.y);
          if(d < 180) continue;
        }

        noBtn.style.left = `${x}px`;
        noBtn.style.top  = `${y}px`;
        return true;
      }

      noBtn.style.left = `${Math.max(minX, maxX*0.7)}px`;
      noBtn.style.top  = `${Math.max(minY, maxY*0.65)}px`;
      return false;
    }

    window.addEventListener('pointermove', (e) => {
      const now = performance.now();
      if(now - lastMove < COOLDOWN_MS) return;

      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top  + r.height/2;
      const dist = Math.hypot(e.clientX - cx, e.clientY - cy);

      const dynamicRadius = Math.max(70, FLEE_RADIUS - dodges * 6);

      if(dist < dynamicRadius){
        detachNoButton();
        dodges++;
        lastMove = now;
        placeNoButtonRandom({x:e.clientX, y:e.clientY});
      }
    }, { passive:true });

    window.addEventListener('resize', () => {
      if (detached){
        row.appendChild(noBtn);
        noBtn.style.position = 'static';
        noBtn.style.left = '';
        noBtn.style.top  = '';
        ph.style.display = 'none';
        detached = false;
        dodges = 0;
      }
    });

    noBtn.addEventListener('click', () => alert("Nice try üòÖ"));

    // ---------- Heart cursor trail ----------
    let lastHeart = 0;
    const HEART_RATE_MS = 14;

    window.addEventListener('pointermove', (e) => {
      const now = performance.now();
      if(now - lastHeart < HEART_RATE_MS) return;
      lastHeart = now;

      const h = document.createElement('span');
      h.className = 'heart';
      h.textContent = '‚ù§';

      const size = 10 + Math.random() * 14;
      const rot  = (Math.random() * 50 - 25);

      h.style.left = `${e.clientX}px`;
      h.style.top  = `${e.clientY}px`;
      h.style.fontSize = `${size}px`;
      h.style.color = Math.random() < 0.5 ? '#ff4fa3' : '#ff86c6';
      h.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;

      document.body.appendChild(h);
      h.addEventListener('animationend', () => h.remove());
    }, { passive:true });
  </script>
</body>
</html>
